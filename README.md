### Artemis CubeSat – PDU MCU Firmware

## Harmony v3 / MPLAB X project*

---

#### Overview

This repository contains the flight-software layer that runs on the SAME51 micro-controller of the **Power Distribution Unit (PDU)**.
It handles three things only:

1. **System bring-up & main loop** (`main.c`) 
2. **Application logic** (initial-state, UART command handling, watchdog feed) (`app.c/.h`) 
3. **Binary command / telemetry packets** (`pdu_packet.c/.h`) 

Keeping each concern in its own file makes code-review and flight qualification straightforward.

---

#### File-by-file

| File               | Role in the build                                                                                                                                                                                                                              |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`main.c`**       | Entry point generated by MPLAB Harmony. Calls `SYS_Initialize()`, then passes control to the application by looping on `APP_Tasks()`.                                                                                                          |
| **`app.h`**        | Declares the `APP_DATA` struct, plus prototypes for `APP_Initialize()` and `APP_Tasks()`. No business logic—just definitions shared with the rest of the project.                                                                              |
| **`app.c`**        | Implements the high-level behaviour:<br>• disables every switch at power-up (`APP_Initialize`)  <br>• continually reads the UART buffer, then dispatches packets via `decode_pdu_packet()`  <br>• (when present) kicks the MAX16998 watchdog.  |
| **`pdu_packet.h`** | Protocol definition layer—enumerations for `PING`, `SET_SWITCH`, `GET_SWITCH_STATUS`, index constants for the packet fields, and the `PDU_Type` switch map.                                                                                    |
| **`pdu_packet.c`** | Parses one inbound packet at a time, executes the three supported op-codes, and assembles the matching response. All GPIO manipulation lives here, so hardware control is isolated from the rest of the code.                                  |

---

#### Build & Flash

Please follow the step-by-step guide in the project’s “Build & Programming Instructions” document:

[Build & Flash Instructions](https://docs.google.com/document/d/1mCISQ2FT9NdC7M1yRxyKPuSgM1M17ViQa_bvZ7Jp-Uk/edit?usp=sharing)

The document covers toolchain setup, project configuration in MPLAB X, and how to program the SAME51 MCU via the Microchip programmer.

---

#### CLI / Packet interface

| Op-code             | Purpose                                                                                          |
| ------------------- | ------------------------------------------------------------------------------------------------ |
| `PING`              | Returns `ACK`—used by the ground station for a liveness check.                                   |
| `SET_SWITCH`        | Turns any of the 3 V3/5 V/12 V rails, VBATT, burn-wires, or torque-coil H-bridge legs on or off. |
| `GET_SWITCH_STATUS` | Reads back the current latch state of every switch for telemetry verification.                   |

*(All packet layouts and value enums live in `pdu_packet.h`; parsing logic is in `pdu_packet.c`.)*

---

#### Folder structure

```
/artemis-cubesat-pdu-firmware
│  main.c
│  app.c
│  app.h
│  pdu_packet.c
│  pdu_packet.h
│  packs/ <- Harmony-generated BSP & peripheral drivers (can ignore)
│  third_party/ <- Harmony-generated BSP & peripheral drivers (can ignore)
│  Teensy/ <- Harmony-generated BSP & peripheral drivers (can ignore)
└─ default/ <- Harmony-generated BSP & peripheral drivers (can ignore)
```

Nothing else is required—these five files plus the Harmony auto-generated scaffolding build a complete PDU image.

---

#### License

See the top-of-file headers in each source for MIT/Apache notices as applicable.
